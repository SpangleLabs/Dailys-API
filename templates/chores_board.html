<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chores board</title>
    <link rel="stylesheet" type="text/css" href="/static/base_style.css" />
</head>
<body>
<h1>Chores board {{ today }}</h1>
<table>
    <tr>
    {% for column in layout['columns'] %}
        <td style="vertical-align: top">
        {% for category in column['categories'] %}
            <h2>{{ category.capitalize() }}</h2>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Last done</th>
                    <th>Next date</th>
                    <th></th>
                </tr>
                {% for chore in categorised_chores[category] %}
                    <tr>
                    <td>{{ chore.display_name }}</td>
                    <td style="background-color: {{ chore.get_latest_date_colour(colour_scale) }}">
                        {{ chore.latest_done or "-" }}
                    </td>
                    <td style="background-color: {{ chore.get_next_date_colour(colour_scale) }}">
                        {{ chore.get_next_date() or "" }}
                    </td>
                    <td onclick='mark_chore_done("{{ chore.id }}")'>
                        Done
                    </td>
                    </tr>
                {% endfor %}
            </table>
        {% endfor %}
        </td>
    {% endfor %}
    </tr>
</table>
<label>Edit auth key: <input type="password" id="edit-key" /></label>
<script type="application/javascript">
function mark_chore_done(chore) {
    const today = "{{ today }}";
    const authKey = document.getElementById("edit-key").value;
    const xhr = new XMLHttpRequest();
    xhr.open("POST", "/forms/chores_done/"+today+"/", true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
    xhr.send("auth_key="+authKey+"&chore="+chore);
    console.log("Chore: "+chore);
    console.log("Date: "+today);
    console.log("Key: "+authKey);
}
</script>
</body>
</html>
